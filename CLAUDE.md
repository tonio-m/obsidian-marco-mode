# Marco Mode Plugin - Development Context

## Plugin Overview
This is an Obsidian plugin that implements an inbox-based note processing workflow with daily note integration. The plugin helps users manage notes through a structured inbox system with timestamp-based organization.

## Core Features

### 1. Inbox Management
- **Go to next inbox note**: Cycles through inbox files alphabetically
- **Mark file as read**: Adds "(READ) " prefix to filename
- **Snooze file**: Renames with timestamp format "Day HH mm ss (snoozed).md"
- **Create new inbox note**: Creates timestamped empty note and opens it

### 2. Daily Note Integration
- **Auto-import on startup**: Checks for daily note content and prompts user to import
- **Manual import**: Command to force import daily note content
- **Append to daily note**: Move inbox note to daily note using natural language dates

### 3. Natural Language Date Processing
- Supports: "today", "yesterday", "tomorrow"
- Day patterns: "this monday", "last friday", etc.
- Uses SuggestModal for smart auto-completion

## File Structure & Settings

```typescript
interface PluginSettings {
    inboxFolder: string;        // Default: '000_inbox'
    dailyNotesFolder: string;   // Default: '001_journal'
}
```

## Key Implementation Details

### Timestamp Format
Uses consistent format across the plugin: `Day HH mm ss` (e.g., "Mon 16 33 00")
- Generated by `formatTimestamp(date: Date)`
- Used for snoozing and new note creation

### Daily Note File Naming
Daily notes follow format: `YYYY-MM-DD.md` (e.g., "2025-08-04.md")
- Generated using `date.toISOString().split('T')[0]`

### Modal Classes
1. **ImportConfirmModal**: Simple yes/no dialog for daily note import
2. **DateSuggestModal**: Smart date picker with auto-completion

### File Operations
- Uses `app.vault.create()`, `app.vault.modify()`, `app.vault.delete()`, `app.vault.rename()`
- Always checks file existence before operations
- Proper error handling with user notices

## Development Considerations

### Startup Behavior
- Plugin loads with 2-second delay before checking daily notes
- This ensures Obsidian is fully ready before showing modals
- Debug logging helps track execution flow

### Date Parsing Logic
- Natural language date parsing is self-contained (no external dependencies)
- Handles week boundaries correctly for "this/last [day]" patterns
- Falls back gracefully for unrecognized formats

### User Experience
- Consistent use of Notice for feedback
- Commands have both palette and ribbon access where appropriate
- Validation prevents operations on non-inbox files

### Error Handling
- File operations wrapped in try-catch blocks
- User-friendly error messages via Notice
- Graceful degradation when files don't exist

## Common Modification Patterns

### Adding New Commands
1. Add to `onload()` using `addCommand()` or `addCommandAndRibbon()`
2. Implement the callback method
3. Add validation if it operates on specific file types

### Extending Date Parsing
- Modify `parseDateString()` method in both plugin and modal classes
- Add new patterns to `getSuggestions()` in DateSuggestModal
- Test week boundary edge cases

### Adding Settings
1. Update `PluginSettings` interface
2. Add to `DEFAULT_SETTINGS`
3. Create setting in `SettingTab.display()`
4. Use `addTextSetting()` helper for consistency

## File Path Patterns
- Inbox files: `${settings.inboxFolder}/[filename].md`
- Daily notes: `${settings.dailyNotesFolder}/YYYY-MM-DD.md`
- New notes: Timestamped format in inbox folder

## Plugin Dependencies
- Core Obsidian API only (no external plugins required)
- Uses built-in Modal, SuggestModal, Notice, Setting components

## Testing Considerations
- Test with various folder structures
- Verify timestamp generation across time zones
- Check modal behavior on plugin reload
- Validate date parsing edge cases (week boundaries, month boundaries)

## Performance Notes
- File filtering uses efficient array methods
- Date parsing is lightweight and cached within modal lifecycle
- No heavy operations on plugin load (except delayed daily note check)